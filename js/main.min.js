!function(){function e(){C._degrees+=360,C.style.transform=C.style.webkitTransform=C.style.mozTransform="rotate("+C._degrees+"deg)"}function n(e){clearInterval(C._interval),setTimeout(function(){C.classList.add("transparent")},e)}function t(){function e(e,n,t){var i=[TWEEN.Easing.Linear.None,TWEEN.Easing.Quadratic.In,TWEEN.Easing.Quadratic.Out,TWEEN.Easing.Quadratic.InOut],o=i[Math.floor(Math.random()*i.length)],a=new TWEEN.Tween(g.morphTargetInfluences).to(e,n).easing(o);return t&&a.onComplete(t),a.start(),a}function n(){return Math.floor(101*Math.random())}if(g&&!(x&&new Date-x<=50)){R&&(R.stop(),R=null);var t=400+4e3*Math.random(),i={};for(var o in M)i[o]=0;e(i,t);for(var a={},r=Math.floor(6*Math.random())+3,s=0;r>s;s++){for(var d=n();void 0!==M[d];)d=n();a[d]=Math.random()*_+1}R=e(a,t,function(){R=null}),M=a,_=Math.min(_+.1,4.69),x=new Date}}function i(){E=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),E.position.z=500,h=new THREE.Scene,h.fog=new THREE.Fog(0,1,15e3),window.scene=h;var e=new THREE.PointLight(16777215,.5);e.position.set(100,0,500),h.add(e);var t=new THREE.AmbientLight(16777215);h.add(t);var i=new THREE.JSONLoader;i.load(b.base+"face.json",function(t,o){n(800);var a=THREE.ImageUtils.loadTexture(b.base+b.texturePrefix+P.body),r=THREE.ImageUtils.loadTexture(b.base+b.texturePrefix+P.bodyNormal);o[0].map=a,o[0].normalMap||(o[0].normalMap=r),o.forEach(function(e){e.morphTargets=!0,new TWEEN.Tween(e).to({opacity:1},1600).onComplete(function(){e.transparent=!1}).start()});var s=new THREE.MultiMaterial(o);g=new THREE.Mesh(t,s),g.scale.set(1.5,1.5,1.5),g.position.set(b.facePosition[0],b.facePosition[1],b.facePosition[2]),e.target=g,h.add(g),y&&!b.noHair&&i.load(b.base+"hair.json",function(e){var n=THREE.ImageUtils.loadTexture(b.base+b.texturePrefix+P.hair),t=THREE.ImageUtils.loadTexture(b.base+b.texturePrefix+P.hairNormal),i=new THREE.MeshPhongMaterial({map:n,normalMap:t}),o=new THREE.Mesh(e,i);o.scale.set(100,100,100),o.position.set(b.hairPosition[0],b.hairPosition[1],b.hairPosition[2]),g.add(o)}),H&&i.load(b.base+"eyes.json",function(e){var n=new THREE.MeshPhongMaterial({map:a,normalMap:r}),t=new THREE.Mesh(e,n);t.scale.set(100,100,100),t.position.set(b.eyePosition[0],b.eyePosition[1],b.eyePosition[2]),g.add(t)})});try{w=new THREE.WebGLRenderer({preserveDrawingBuffer:!0})}catch(a){k=!1,w=new THREE.CanvasRenderer({})}w.setClearColor(16711422),w.setPixelRatio(window.devicePixelRatio),w.setSize(window.innerWidth,window.innerHeight),w.sortObjects=!1,document.body.appendChild(w.domElement),window.addEventListener("resize",o,!1)}function o(){L=window.innerWidth/2,S=window.innerHeight/2,E.aspect=window.innerWidth/window.innerHeight,E.updateProjectionMatrix(),w.setSize(window.innerWidth,window.innerHeight)}function a(e){W=e.clientX-L,I=2*(e.clientY-S)}function r(e){switch(e.keyCode){case 115:s();break;case 102:d()}}function s(){if(w){var e=w.domElement.toDataURL();window.open(e,"_blank")}}function d(){N=!N,z.textContent=(N?"Freeze me":"Unfreeze me")+' ("f")'}function c(){requestAnimationFrame(c),l()}function l(){TWEEN.update(),g&&N&&(g.rotation.y=W/L*Math.PI*.1,E.rotation.x=I/S*Math.PI*.003),w.render(h,E)}function u(e,n){var t=document.createElement("audio");return t.preload=!0,t.volume=void 0!==n?n:.25,e&&(t.src=e),t}function f(e){e.currentTime=0,e.play()}function m(){return"media/breath"+(Math.floor(15*Math.random())+1)+".mp3"}var E,h,w,g,p={prof:{base:"models/prof/",texturePrefix:"business_prof_",facePosition:[0,-248,420],eyePosition:[0,0,0],hairPosition:[0,0,0]},stefani:{base:"models/Stefani/",texturePrefix:"Stefani_",facePosition:[0,-460,360],noHair:!0,eyePosition:[.74,-.42,2.52],hairPosition:[.64,0,3]},beanie:{base:"models/Beanie/",texturePrefix:"beanie_woman_",facePosition:[0,-225,420],eyePosition:[0,0,.75],hairPosition:[0,0,1]},douglas:{base:"models/Douglas/",texturePrefix:"Douglas_",facePosition:[0,-250,420],eyePosition:[-.3,-.3,-7],noHair:!0},jacket:{base:"models/Jacket/",texturePrefix:"jacket_",facePosition:[0,-218,420],eyePosition:[0,0,1.25],hairPosition:[0,1,0]}},P={hair:"Hair_Diffuse.png",body:"Body_Diffuse.png",hairNormal:"Hair_Normal.png",bodyNormal:"Body_Normal.png"},T=["prof","stefani","beanie","douglas","jacket"],v=T[Math.floor(Math.random()*T.length)],b=p[v],y=!0,H=!0,M={},x=null,R=null,_=.25,k=!0,N=!0,W=0,I=0,L=window.innerWidth/2,S=window.innerHeight/2,C=document.querySelector(".loading-indicator");C._degrees=0,setTimeout(e,1),C._interval=setInterval(e,3e3);var j={click:u("media/click.mp3",1),breath:u()};document.querySelector(".big-button").onclick=function(){t(),f(j.click),j.breath.src=m(),f(j.breath)},document.addEventListener("mousemove",a,!1),document.addEventListener("keypress",r,!1);var z=document.querySelector(".freeze-instruction");z.onclick=d;var D=document.querySelector(".save-instruction");D.onclick=s,setTimeout(function(){i(),c()},1)}();
